_context.invoke("Utils",function(undefined){function getValue(interval){return"number"==typeof interval?interval:interval instanceof DateInterval?interval.getLength():DateInterval.from(interval).getLength()}function formatAuto(interval,precision){precision===!0?precision=intervalNames.length:precision||(precision=2);var i,v,last,str=[],sign="";for(interval<0&&(sign="-",interval=-interval),i=0;i<intervalNames.length&&!(interval>=intervalLengths[i]&&(precision--,v=interval/intervalLengths[i],v=0===precision?Math.round(v):Math.floor(v),str.push(v+" "+intervalHelpers[i].toString(v)),interval-=v*intervalLengths[i],0===precision));i++);return str.length>2?(last=str.pop(),sign+str.join(separators[0])+(separators[1]||separators[0])+last):sign+str.join(separators[1]||separators[0])}function format(interval,pattern){var sign=interval<0?"-":"+";return interval=Math.abs(interval),(pattern+"").replace(/%(.)/g,function(m,f){var v,pad=!1;switch(f){case"%":return"%";case"y":m=intervalLengths[0];break;case"w":m=intervalLengths[1];break;case"m":pad=!0;case"n":m=intervalLengths[2];break;case"d":pad=!0;case"j":m=intervalLengths[3];break;case"H":pad=!0;case"G":m=intervalLengths[4];break;case"i":pad=!0;case"I":m=intervalLengths[5];break;case"s":pad=!0;case"S":m=intervalLengths[6];break;case"-":return"-"===sign?sign:"";case"+":return sign;default:throw new Error("Unknown format modifier: %"+f)}return v=Math.floor(interval/m),interval-=m*v,pad&&v<10?"0"+v:v})}var DateInterval=function(interval){this._={initialized:!1,interval:interval}};DateInterval.from=function(interval){return new DateInterval(interval)};var intervalNames=["year","month","week","day","hour","minute","second","millisecond"],intervalLengths=[31536e6,6048e5,26784e5,864e5,36e5,6e4,1e3,1],intervalHelpers=[{pattern:/^y(?:ears?)?$/,toString:function(n){return 1===n?"year":"years"}},{pattern:/^mon(?:ths?)?$/,toString:function(n){return 1===n?"month":"months"}},{pattern:/^w(?:eeks?)?$/,toString:function(n){return 1===n?"week":"weeks"}},{pattern:/^d(?:ays?)?$/,toString:function(n){return 1===n?"day":"days"}},{pattern:/^h(?:ours?)?$/,toString:function(n){return 1===n?"hour":"hours"}},{pattern:/^min(?:utes?)?$/,toString:function(n){return 1===n?"minute":"minutes"}},{pattern:/^s(?:ec(?:onds?)?)?$/,toString:function(n){return 1===n?"second":"seconds"}},{pattern:/^millis(?:econds?)?$|^ms$/,toString:function(n){return 1===n?"millisecond":"milliseconds"}}],separators=[", "," and "];DateInterval.setHelpers=function(helpers){intervalHelpers=helpers},DateInterval.setSeparators=function(separator,last){separators=[separator,last]},DateInterval.prototype.add=function(interval){return this._initialize(),this._.interval+=getValue(interval),this},DateInterval.prototype.subtract=function(interval){return this._initialize(),this._.interval-=getValue(interval),this},DateInterval.prototype.isNegative=function(){return this._initialize(),this._.interval<0},DateInterval.prototype.getLength=function(){return this._initialize(),this._.interval},DateInterval.prototype.valueOf=function(){return this.getLength()},DateInterval.prototype.format=function(pattern){return this._initialize(),"boolean"!=typeof pattern&&"number"!=typeof pattern&&pattern?format(this._.interval,pattern):formatAuto(this._.interval,pattern)},DateInterval.prototype._initialize=function(){if(!this._.initialized&&(this._.initialized=!0,"number"!=typeof this._.interval)){var interval=this._.interval;if(interval instanceof DateInterval)this._.interval=interval.getLength();else{if("string"!=typeof interval)throw new Error("Invalid interval specification, expected string, number or a DateInterval instance");if(interval.match(/^\s*(?:\+|-)?\s*\d+\s*$/))this._.interval=parseInt(interval.trim());else{var rest,res=0,sign=1;if(rest=interval.replace(/\s*(\+|-)?\s*(\d+)\s+(\S+)\s*/g,function(m,s,n,k){s!==undefined&&(sign="+"===s?1:-1),k=k.toLowerCase(),n=parseInt(n)*sign,m=null;for(var i=0;i<intervalHelpers.length;i++)if(intervalHelpers[i].pattern.test(k)){m=intervalLengths[i];break}if(null===m)throw new Error('Unknown keyword: "'+k+'"');return res+=n*m,""}),rest.length)throw new Error('Invalid interval specification "'+interval+'", didn\'t understand "'+rest+'"');this._.interval=res}}}},_context.register(DateInterval,"DateInterval")}),_context.invoke("Utils",function(Strings,Arrays,DateInterval,undefined){var DateTime=function(d){this._={initialized:!1,date:d||new Date}};DateTime.keywords={weekdays:{abbrev:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{abbrev:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],full:["January","February","March","April","May","June","July","August","September","October","November","December"]},relative:{now:"now",today:"today",tomorrow:"tomorrow",yesterday:"yesterday",noon:"noon",midnight:"midnight",at:"at"}},DateTime.from=function(s){return new DateTime(s)},DateTime.now=function(){return new DateTime},DateTime.isDateObject=function(o){return"object"==typeof o&&o&&o.date!==undefined&&o.timezone!==undefined&&o.timezone_type!==undefined},DateTime.isLeapYear=function(y){return y%4===0&&y%100!==0||y%400===0},DateTime.isModifyString=function(str){var kw=DateTime.keywords.relative,re=new RegExp("(?:^(?:"+[kw.now,kw.yesterday,kw.tomorrow,kw.today].map(Strings.escapeRegex).join("|")+"))|"+Strings.escapeRegex(kw.noon)+"|"+Strings.escapeRegex(kw.midnight)+"|\\d?\\d(?::\\d\\d|\\s*(?:am|pm))(?:\\d\\d)?(?:\\s*(?:am|pm))?|(?:[-+]\\s*)?\\d+\\s+[^\\d\\s]","i");return re.test(str)},DateTime.getDaysInMonth=function(m,y){return 2===m?DateTime.isLeapYear(y)?29:28:m in{4:1,6:1,9:1,11:1}?30:31};var ni=function(){throw new Error("Not implemented!")},pad=function(n){return n<10?"0"+n:n},formatTz=function(offset){return("string"==typeof offset||offset instanceof String)&&offset.match(/(\+|-)\d\d:\d\d/)?offset:("number"!=typeof offset&&(offset=parseInt(offset)),(offset<0?"+":"-")+pad(parseInt(Math.abs(offset)/60))+":"+pad(Math.abs(offset)%60))};DateTime.getLocalTzOffset=function(){return formatTz((new Date).getTimezoneOffset())},DateTime.formatModifiers={d:function(d,u){return pad(u?d.getUTCDate():d.getDate())},D:function(d,u){return DateTime.keywords.weekdays.abbrev[u?d.getUTCDay():d.getDay()]},j:function(d,u){return u?d.getUTCDate():d.getDate()},l:function(d,u){return DateTime.keywords.weekdays.full[u?d.getUTCDay():d.getDay()]},N:function(d,u,n){return n=u?d.getUTCDay():d.getDay(),0===n?7:n},S:function(d,u,n){return n=u?d.getUTCDate():d.getDate(),n%=10,0===n||n>3?"th":["st","nd","rd"][n-1]},w:function(d,u){return u?d.getUTCDay():d.getDay()},z:function(d,u,n,m,y,M){for(n=u?d.getUTCDate():d.getDate(),n--,y=u?d.getUTCFullYear():d.getFullYear(),m=0,M=u?d.getUTCMonth():d.getMonth();m<M;)n+=DateTime.getDaysInMonth(m++,y);return n},W:ni,F:function(d,u){return DateTime.keywords.months.full[u?d.getUTCMonth():d.getMonth()]},m:function(d,u){return pad((u?d.getUTCMonth():d.getMonth())+1)},M:function(d,u){return DateTime.keywords.months.abbrev[u?d.getUTCMonth():d.getMonth()]},n:function(d,u){return(u?d.getUTCMonth():d.getMonth())+1},t:function(d,u){return DateTime.getDaysInMonth(u?d.getUTCMonth():d.getMonth(),u?d.getUTCFullYear():d.getFullYear())},L:function(d,u){return DateTime.isLeapYear(u?d.getUTCFullYear():d.getFullYear())?1:0},o:ni,Y:function(d,u){return u?d.getUTCFullYear():d.getFullYear()},y:function(d,u){return(u?d.getUTCFullYear():d.getFullYear()).toString().substr(-2)},a:function(d,u,h){return h=u?d.getUTCHours():d.getHours(),h>=0&&h<12?"am":"pm"},A:function(d,u){return DateTime.formatModifiers.a(d,u).toUpperCase()},g:function(d,u,h){return h=u?d.getUTCHours():d.getHours(),0===h?12:h>12?h-12:h},G:function(d,u){return u?d.getUTCHours():d.getHours()},h:function(d,u){return pad(DateTime.formatModifiers.g(d,u))},H:function(d,u){return pad(u?d.getUTCHours():d.getHours())},i:function(d,u){return pad(u?d.getUTCMinutes():d.getMinutes())},s:function(d,u){return pad(u?d.getUTCSeconds():d.getSeconds())},u:function(d,u){return 1e3*(u?d.getUTCMilliseconds():d.getMilliseconds())},e:ni,I:ni,O:function(d,u){return DateTime.formatModifiers.P(d,u).replace(":","")},P:function(d,u){return u?"+00:00":formatTz(d.getTimezoneOffset())},T:ni,Z:function(d,u){return u?0:d.getTimezoneOffset()*-60},c:function(d,u){return DateTime.from(d).format("Y-m-d\\TH:i:sP",u)},r:function(d,u){return DateTime.from(d).format("D, n M Y G:i:s O",u)},U:function(d){return Math.round(d.getTime()/1e3)}},DateTime.prototype.format=function(f,utc){this._initialize();var d=this._.date,pattern=Strings.escapeRegex(Arrays.getKeys(DateTime.formatModifiers).join(",")).replace(/,/g,"|"),re=new RegExp("(\\\\*)("+pattern+")","g");return f.replace(re,function(s,c,m){return c.length%2?c.substr(1)+m:c+""+DateTime.formatModifiers[m](d,utc)})},["getTime","getDate","getDay","getMonth","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","getTimezoneOffset","getUTCDate","getUTCDay","getUTCMonth","getUTCFullYear","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleFormat","toLocaleTimeString","toString","toTimeString","toUTCString"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments)}}),["setTime","setDate","setMonth","setFullYear","setHours","setMinutes","setSeconds","setMilliseconds","setUTCDate","setUTCMonth","setUTCFullYear","setUTCHours","setUTCMinutes","setUTCSeconds","setUTCMilliseconds"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments),this}}),DateTime.prototype.getTimestamp=function(){return this._initialize(),Math.round(this._.date.getTime()/1e3)},DateTime.prototype.getDateObject=function(){return this._initialize(),this._.date},DateTime.prototype.valueOf=function(){return this.getTimestamp()},DateTime.prototype.modify=function(s){this._initialize();var r,re,t=this._.date.getTime(),kw=DateTime.keywords.relative;if(s instanceof DateInterval)return this._.date=new Date(t+s.getLength()),this;if(s=s.toLowerCase(),re=new RegExp("^("+[kw.yesterday,kw.tomorrow,kw.now,kw.today].map(Strings.escapeRegex).join("|")+")\\s*(?:"+Strings.escapeRegex(kw.at)+"\\s*)?"),r=s.match(re))switch(s=s.substr(r[0].length),r[1]){case kw.now:case kw.today:t=Date.now();break;case kw.yesterday:t-=864e5;break;case kw.tomorrow:t+=864e5}return re=new RegExp("^("+Strings.escapeRegex(kw.noon)+"|"+Strings.escapeRegex(kw.midnight)+"|\\d\\d?(?::\\d\\d|\\s*(?:am|pm))(?::\\d\\d)?(?:\\s*(?:am|pm))?)\\s*"),(r=s.match(re))&&(s=s.substr(r[0].length),t=new Date(t),r[1]===kw.noon?t.setHours(12,0,0,0):r[1]===kw.midnight?t.setHours(0,0,0,0):(r=r[1].match(/^(\d\d?)(?::(\d\d))?(?::(\d\d))?(?:\s*(am|pm))?$/),r[1]=parseInt(r[1]),r[2]=r[2]?parseInt(r[2]):0,r[3]=r[3]?parseInt(r[3]):0,r[4]&&("am"===r[4]&&12===r[1]?r[1]=0:"pm"===r[4]&&r[1]<12&&(r[1]+=12)),t.setHours(r[1],r[2],r[3],0)),t=t.getTime()),s.length&&!s.match(/^\s+$/)&&(t+=DateInterval.from(s).getLength()),this._.date=new Date(t),this},DateTime.prototype.modifyClone=function(s){return DateTime.from(this).modify(s)},DateTime.prototype._initialize=function(){if(!this._.initialized)if(this._.initialized=!0,"string"==typeof this._.date){var m;if(m=this._.date.match(/^@(\d+)$/))this._.date=new Date(1e3*m[1]);else if(m=this._.date.match(/^(\d\d\d\d-\d\d-\d\d)[ T](\d\d:\d\d(?::\d\d(?:\.\d+)?)?)([-+]\d\d:?\d\d)?$/))this._.date=new Date(m[1]+"T"+m[2]+(m[3]||""));else if(DateTime.isModifyString(this._.date)){var s=this._.date;this._.date=new Date,this.modify(s)}else this._.date=new Date(this._.date)}else if("number"==typeof this._.date)this._.date=new Date(this._.date);else if(DateTime.isDateObject(this._.date)){var s=this._.date.date;3===this._.date.timezone_type&&"UTC"!==this._.date.timezone||(s+=" "+this._.date.timezone),this._.date=new Date(s)}else this._.date instanceof DateTime&&(this._.date=new Date(this._.date.getTime()))},_context.register(DateTime,"DateTime")});